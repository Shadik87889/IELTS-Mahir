<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IELTS Mahir - Advanced AI Assistant (Dark)</title>
    <!-- Inter Font - For a professional look -->
    <link rel="stylesheet" href="navigation-dark.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <!-- Font Awesome for icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <!-- Tailwind CSS Script - Always include this for Tailwind to work -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Custom styles for the scrollbar, to maintain consistency in dark theme */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #1f2937; /* A dark gray background for the scrollbar track */
        border-radius: 10px;
      }
      ::-webkit-scrollbar-thumb {
        background: #4b5563; /* A medium gray for the scrollbar thumb */
        border-radius: 10px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #6b7280; /* Lighter gray on hover */
      }
      body {
        font-family: "Inter", sans-serif;
        background-color: #0c0d12; /* A slightly darker, richer background */
        color: #e2e8f0;
        position: relative;
        overflow-x: hidden;
      }

      /* Animated grid overlay for a high-tech feel */
      body::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: linear-gradient(
            rgba(141, 148, 163, 0.05) 1px,
            transparent 1px
          ),
          linear-gradient(90deg, rgba(141, 148, 163, 0.05) 1px, transparent 1px);
        background-size: 50px 50px;
        z-index: -1;
        opacity: 0.8;
        animation: move-grid 20s linear infinite;
      }

      @keyframes move-grid {
        from {
          background-position: 0 0;
        }
        to {
          background-position: 50px 50px;
        }
      }

      /* Specific styles for grammar highlighting on a dark background */
      .grammar-diff del {
        background-color: #450a0a; /* A dark red */
        color: #fca5a5; /* A light red */
        text-decoration: line-through;
        border-radius: 0.125rem; /* rounded-sm */
        padding: 0 0.125rem; /* px-0.5 */
      }
      .grammar-diff ins {
        background-color: #064e3b; /* A dark green */
        color: #a7f3d0; /* A light green */
        text-decoration: none; /* remove default underline */
        font-weight: 600; /* semi-bold to stand out */
        border-radius: 0.125rem; /* rounded-sm */
        padding: 0 0.125rem; /* px-0.5 */
      }
      .grammar-diff span {
        /* For unchanged text, ensure it doesn't get weird styling */
        color: inherit;
      }
      /* When mobile menu is active, prevent body scroll */
      body.menu-open {
        overflow: hidden;
      }
      body.menu-open .moving-products-text {
        display: none; /* Hide the element when the menu is open */
      }
      .hamburger-menu {
        margin-right: 5vw !important;
      }
    </style>
  </head>
  <body class="font-inter">
    <nav>
      <div class="logo-ai-parent">
        <a href="home" class="logo">
          <img
            src="assets/278115481_106536582034386_7446598694214552893_n-removebg-preview.png"
            alt="Ielts mahir logo"
          />
        </a>
      </div>
      <div id="auth-buttons-container" class="auth-container">
        <div class="auth-loading-pulse">
          <div class="auth-loading-circle"></div>
          <div class="auth-loading-content">
            <div class="auth-loading-bar"></div>
            <div class="auth-loading-grid">
              <div class="auth-loading-bar auth-loading-col-2"></div>
              <div class="auth-loading-bar auth-loading-col-1"></div>
            </div>
            <div class="auth-loading-bar"></div>
          </div>
        </div>
      </div>
    </nav>
    <div
      id="main-container"
      class="min-h-screen mt-[-1.5vw] text-gray-200 flex flex-col items-center mt-[22vw] md:mt-[16vw] lg:mt-20 p-4 py-6 lg:py-4"
    >
      <!-- Main Content Area: Sidebar and Editor/Results -->
      <div
        class="flex flex-col lg:flex-row flex-grow w-full gap-6 md:gap-8 bg-gray-800 rounded-3xl overflow-hidden lg:py-[0] py-[0]"
      >
        <!-- Left Section: Sidebar for Feature Cards -->
        <aside
          class="w-full lg:w-[20vw] flex-shrink-0 bg-gray-800 rounded-tl-3xl rounded-bl-3xl p-6 md:p-8 lg:mt-3"
        >
          <h2
            class="text-2xl md:text-3xl font-bold text-gray-100 mb-5 text-center lg:text-left"
          >
            Features
          </h2>

          <!-- Feature Cards Grid inside Sidebar -->
          <div
            class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-1 xl:grid-cols-2 gap-3"
          >
            <!-- Grammar Card -->
            <button
              id="checkGrammarButton"
              class="feature-card flex flex-col items-center justify-center p-3 sm:p-4 bg-gray-900 text-gray-200 rounded-xl border border-gray-700 shadow-sm hover:bg-gray-700 hover:border-gray-600 transform hover:-translate-y-0.5 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-300 active:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed"
              data-feature="grammar"
              aria-live="polite"
            >
              <!-- Feather icon: File text -->
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="30"
                height="30"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="text-purple-400 mb-2"
              >
                <path
                  d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"
                ></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="16" y1="13" x2="8" y2="13"></line>
                <line x1="16" y1="17" x2="8" y2="17"></line>
                <line x1="10" y1="9" x2="8" y2="9"></line>
              </svg>
              <span
                class="text-sm sm:text-base font-semibold text-gray-200 text-center"
                >Grammar & Spell</span
              >
            </button>

            <!-- Summarize Card -->
            <button
              id="summarizeButton"
              class="feature-card flex flex-col items-center justify-center p-3 sm:p-4 bg-gray-900 text-gray-200 rounded-xl border border-gray-700 shadow-sm hover:bg-gray-700 hover:border-gray-600 transform hover:-translate-y-0.5 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-300 active:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed"
              data-feature="summarize"
              aria-live="polite"
            >
              <!-- Feather icon: Compress -->
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="30"
                height="30"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="text-indigo-400 mb-2"
              >
                <path d="M8 3H4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h4"></path>
                <path d="M16 21h4a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2h-4"></path>
                <line x1="12" y1="12" x2="18" y2="18"></line>
                <line x1="6" y1="6" x2="12" y2="12"></line>
              </svg>
              <span
                class="text-sm sm:text-base font-semibold text-gray-200 text-center"
                >Summarize Text</span
              >
            </button>

            <!-- Tone Analysis Card -->
            <button
              id="analyzeToneButton"
              class="feature-card flex flex-col items-center justify-center p-3 sm:p-4 bg-gray-900 text-gray-200 rounded-xl border border-gray-700 shadow-sm hover:bg-gray-700 hover:border-gray-600 transform hover:-translate-y-0.5 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-300 active:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed"
              data-feature="tone"
              aria-live="polite"
            >
              <!-- Feather icon: Heart / Mood -->
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="30"
                height="30"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="text-green-400 mb-2"
              >
                <path
                  d="M12 21.35l-1.45-1.32C5.4 14.07 2 10.15 2 7.5A4.5 4.5 0 0 1 6.5 3a4.5 4.5 0 0 1 4.5 4.5c0 .32-.03.62-.09.91L12 9.07l.09-.91c-.06-.29-.09-.59-.09-.91A4.5 4.5 0 0 1 17.5 3a4.5 4.5 0 0 1 4.5 4.5c0 2.65-3.4 6.57-8.55 11.53L12 21.35z"
                ></path>
              </svg>
              <span
                class="text-sm sm:text-base font-semibold text-gray-200 text-center"
                >Analyze Tone</span
              >
            </button>

            <!-- Paraphrase Card -->
            <button
              id="paraphraseButton"
              class="feature-card flex flex-col items-center justify-center p-3 sm:p-4 bg-gray-900 text-gray-200 rounded-xl border border-gray-700 shadow-sm hover:bg-gray-700 hover:border-gray-600 transform hover:-translate-y-0.5 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-300 active:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed"
              data-feature="paraphrase"
              aria-live="polite"
            >
              <!-- Feather icon: Repeat -->
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="30"
                height="30"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="text-purple-400 mb-2"
              >
                <polyline points="17 1 21 5 17 9"></polyline>
                <path d="M21 5H3a2 2 0 0 0-2 2v2"></path>
                <polyline points="7 23 3 19 7 15"></polyline>
                <path d="M3 19h18a2 2 0 0 0 2-2v-2"></path>
              </svg>
              <span
                class="text-sm sm:text-base font-semibold text-gray-200 text-center"
                >Paraphrase</span
              >
            </button>

            <!-- Keywords Card -->
            <button
              id="keywordsButton"
              class="feature-card flex flex-col items-center justify-center p-3 sm:p-4 bg-gray-900 text-gray-200 rounded-xl border border-gray-700 shadow-sm hover:bg-gray-700 hover:border-gray-600 transform hover:-translate-y-0.5 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-300 active:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed"
              data-feature="keywords"
              aria-live="polite"
            >
              <!-- Feather icon: Tag -->
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="30"
                height="30"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="text-blue-400 mb-2"
              >
                <path
                  d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"
                ></path>
                <line x1="7" y1="7" x2="7.01" y2="7"></line>
              </svg>
              <span
                class="text-sm sm:text-base font-semibold text-gray-200 text-center"
                >Extract Keywords</span
              >
            </button>

            <!-- Readability Card -->
            <button
              id="readabilityButton"
              class="feature-card flex flex-col items-center justify-center p-3 sm:p-4 bg-gray-900 text-gray-200 rounded-xl border border-gray-700 shadow-sm hover:bg-gray-700 hover:border-gray-600 transform hover:-translate-y-0.5 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-300 active:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed"
              data-feature="readability"
              aria-live="polite"
            >
              <!-- Feather icon: Book Open -->
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="30"
                height="30"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="text-orange-400 mb-2"
              >
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
              </svg>
              <span
                class="text-sm sm:text-base font-semibold text-gray-200 text-center"
                >Readability</span
              >
            </button>

            <!-- Conciseness Card -->
            <button
              style="display: ;"
              id="concisenessButton"
              class="feature-card flex flex-col items-center justify-center p-3 sm:p-4 bg-gray-900 text-gray-200 rounded-xl border border-gray-700 shadow-sm hover:bg-gray-700 hover:border-gray-600 transform hover:-translate-y-0.5 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-300 active:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed"
              data-feature="conciseness"
              aria-live="polite"
            >
              <!-- Feather icon: Scissors -->
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="30"
                height="30"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="text-red-400 mb-2"
              >
                <circle cx="6" cy="7" r="3"></circle>
                <circle cx="6" cy="17" r="3"></circle>
                <line x1="10" y1="12" x2="18" y2="12"></line>
                <line x1="21" y1="7" x2="18" y2="10"></line>
                <line x1="21" y1="17" x2="18" y2="14"></line>
              </svg>
              <span
                class="text-sm sm:text-base font-semibold text-gray-200 text-center"
                >Conciseness</span
              >
            </button>

            <!-- Clear All Button (as a distinct card) -->
            <button
              id="clearAllButton"
              class="col-span-full feature-card flex flex-col items-center justify-center p-3 sm:p-4 bg-gray-700 text-gray-200 rounded-xl border border-gray-600 shadow-sm hover:bg-gray-600 transform hover:-translate-y-0.5 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-gray-500"
            >
              <!-- Feather icon: Trash Can -->
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="30"
                height="30"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="text-gray-400 mb-2"
              >
                <path d="M3 6h18"></path>
                <path
                  d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
                ></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
              </svg>
              <span
                class="text-sm sm:text-base font-semibold text-gray-200 text-center"
                >Clear All</span
              >
            </button>
          </div>
        </aside>

        <!-- Right Section: Input & Output Areas -->
        <main
          class="flex-1 flex flex-col lg:flex-row gap-6 md:gap-8 bg-gray-800 p-6 md:p-10"
        >
          <!-- Left Sub-Section: Input Area -->
          <div class="flex-1 flex flex-col">
            <h2
              class="text-2xl md:text-3xl font-bold text-gray-100 mb-5 text-center lg:text-left"
            >
              Input Your Text
            </h2>

            <div class="mb-4 flex-grow">
              <textarea
                id="inputText"
                class="w-full h-[28rem] md:h-[36rem] p-4 border border-gray-700 bg-gray-900 rounded-xl focus:ring-4 focus:ring-indigo-600 focus:border-indigo-600 transition-all duration-200 resize-none text-base md:text-lg text-gray-200 shadow-sm placeholder-gray-500"
                placeholder="Paste your text here to get started..."
                aria-label="Text input for writing assistant features"
              ></textarea>
            </div>

            <!-- Text Statistics -->
            <div class="flex justify-between text-sm text-gray-400 mb-6 px-1">
              <span id="wordCount">Words: 0</span>
              <span id="charCount">Characters: 0</span>
            </div>
          </div>

          <!-- Right Sub-Section: Output Area -->
          <div class="flex-1 mt-8 lg:mt-0 flex flex-col">
            <h2
              class="text-2xl md:text-3xl font-bold text-gray-100 mb-5 text-center lg:text-left"
            >
              Results
            </h2>

            <p
              id="errorMessage"
              class="mb-4 text-red-400 text-center lg:text-left font-medium hidden px-1"
              role="alert"
            ></p>

            <!-- Loading Spinner Container (centralized) -->
            <div
              id="loadingContainer"
              class="flex-grow flex flex-col items-center justify-center bg-gray-900 rounded-xl border border-gray-700 shadow-inner hidden"
            >
              <svg
                class="animate-spin h-14 w-14 text-indigo-400 mb-4"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
              >
                <circle
                  class="opacity-25"
                  cx="12"
                  cy="12"
                  r="10"
                  stroke="currentColor"
                  stroke-width="4"
                ></circle>
                <path
                  class="opacity-75"
                  fill="currentColor"
                  d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                ></path>
              </svg>
              <span class="text-xl text-gray-400 font-semibold" id="loadingText"
                >Processing...</span
              >
            </div>

            <!-- Output Sections (initially all hidden except default placeholder) -->
            <div
              id="outputContainer"
              class="flex-grow relative bg-gray-900 p-5 h-[340px] md:min-h-[320px] lg:min-h-[400px] border border-gray-700 rounded-xl text-base md:text-lg text-gray-200 shadow-inner overflow-auto"
            >
              <p
                id="generalPlaceholderText"
                class="text-gray-500 italic text-center py-5"
              >
                Select a feature to see the results here.
              </p>

              <!-- Grammar Correction Output -->
              <div id="grammarOutput" class="output-section hidden">
                <h3 class="text-xl font-bold text-gray-100 mb-3">
                  Refined Text
                </h3>
                <!-- Corrected text will be inserted here with highlighting -->
                <div
                  id="correctedText"
                  class="whitespace-pre-wrap grammar-diff leading-relaxed"
                ></div>
                <p
                  class="feature-error-message mt-2 text-red-400 font-medium hidden"
                ></p>
              </div>

              <!-- Summarizer Output -->
              <div id="summarizerOutput" class="output-section hidden">
                <h3 class="text-xl font-bold text-gray-100 mb-3">Summary</h3>
                <p
                  id="summarizedText"
                  class="whitespace-pre-wrap leading-relaxed"
                ></p>
                <p
                  class="feature-error-message mt-2 text-red-400 font-medium hidden"
                ></p>
              </div>

              <!-- Tone Analysis Output -->
              <div id="toneOutput" class="output-section hidden">
                <h3 class="text-xl font-bold text-gray-100 mb-3">
                  Tone Analysis
                </h3>
                <p
                  id="analyzedTone"
                  class="whitespace-pre-wrap leading-relaxed"
                ></p>
                <p
                  class="feature-error-message mt-2 text-red-400 font-medium hidden"
                ></p>
              </div>

              <!-- Paraphrase Output -->
              <div id="paraphraseOutput" class="output-section hidden">
                <h3 class="text-xl font-bold text-gray-100 mb-3">
                  Paraphrased Text
                </h3>
                <p
                  id="paraphrasedText"
                  class="whitespace-pre-wrap leading-relaxed"
                ></p>
                <p
                  class="feature-error-message mt-2 text-red-400 font-medium hidden"
                ></p>
              </div>

              <!-- Keywords Output -->
              <div id="keywordsOutput" class="output-section hidden">
                <h3 class="text-xl font-bold text-gray-100 mb-3">Keywords</h3>
                <p
                  id="extractedKeywords"
                  class="whitespace-pre-wrap leading-relaxed"
                ></p>
                <p
                  class="feature-error-message mt-2 text-red-400 font-medium hidden"
                ></p>
              </div>

              <!-- Readability Output -->
              <div id="readabilityOutput" class="output-section hidden">
                <h3 class="text-xl font-bold text-gray-100 mb-3">
                  Readability Assessment
                </h3>
                <p
                  id="readabilityAssessment"
                  class="whitespace-pre-wrap leading-relaxed"
                ></p>
                <p
                  class="feature-error-message mt-2 text-red-400 font-medium hidden"
                ></p>
              </div>

              <!-- Conciseness Output -->
              <div id="concisenessOutput" class="output-section hidden">
                <h3 class="text-xl font-bold text-gray-100 mb-3">
                  Conciseness Suggestions
                </h3>
                <p
                  id="concisenessSuggestions"
                  class="whitespace-pre-wrap leading-relaxed"
                ></p>
                <p
                  class="feature-error-message mt-2 text-red-400 font-medium hidden"
                ></p>
              </div>
            </div>

            <!-- Copy Button (Conditionally visible) -->
            <div
              id="copyButtonContainer"
              class="mt-6 flex justify-center lg:justify-end hidden"
            >
              <button
                id="copyToClipboardButton"
                class="px-6 py-3 bg-indigo-600 text-white font-semibold rounded-xl border border-indigo-600 shadow-sm hover:bg-indigo-700 hover:border-indigo-700 transition-colors duration-200 flex items-center gap-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 transform hover:scale-[1.02] active:scale-[0.98]"
                aria-label="Copy result to clipboard"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke-width="2"
                  stroke="currentColor"
                  class="w-6 h-6"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75m11.25 0H16.5a2.25 2.25 0 00-2.25 2.25v2.25M15 1.5V5.25m4.5 9.75v-4.5m-1.5 1.5h.75m-7.5 0v-4.5m1.5 1.5h.75m7.5 0l-.75 2.25m-3.75 0L12 18l-.75 2.25"
                  />
                </svg>
                <span id="copyButtonText">Copy Result</span>
              </button>
            </div>
          </div>
        </main>
      </div>
    </div>

    <script>
      // Get references to DOM elements
      const inputTextarea = document.getElementById("inputText");
      const checkGrammarBtn = document.getElementById("checkGrammarButton");
      const summarizeButton = document.getElementById("summarizeButton");
      const analyzeToneButton = document.getElementById("analyzeToneButton");
      const paraphraseButton = document.getElementById("paraphraseButton");
      const keywordsButton = document.getElementById("keywordsButton");
      const readabilityButton = document.getElementById("readabilityButton");
      const concisenessButton = document.getElementById("concisenessButton");
      const clearAllButton = document.getElementById("clearAllButton");

      const loadingContainer = document.getElementById("loadingContainer");
      const loadingText = document.getElementById("loadingText");
      const errorMessage = document.getElementById("errorMessage"); // General input validation error

      const outputContainer = document.getElementById("outputContainer");
      const generalPlaceholderText = document.getElementById(
        "generalPlaceholderText"
      );

      // Output sections and their content elements
      const featureOutputs = {
        grammar: {
          container: document.getElementById("grammarOutput"),
          content: document.getElementById("correctedText"),
        },
        summarize: {
          container: document.getElementById("summarizerOutput"),
          content: document.getElementById("summarizedText"),
        },
        tone: {
          container: document.getElementById("toneOutput"),
          content: document.getElementById("analyzedTone"),
        },
        paraphrase: {
          container: document.getElementById("paraphraseOutput"),
          content: document.getElementById("paraphrasedText"),
        },
        keywords: {
          container: document.getElementById("keywordsOutput"),
          content: document.getElementById("extractedKeywords"),
        },
        readability: {
          container: document.getElementById("readabilityOutput"),
          content: document.getElementById("readabilityAssessment"),
        },
        conciseness: {
          container: document.getElementById("concisenessOutput"),
          content: document.getElementById("concisenessSuggestions"),
        },
      };

      const copyButtonContainer = document.getElementById(
        "copyButtonContainer"
      );
      const copyToClipboardBtn = document.getElementById(
        "copyToClipboardButton"
      );
      const copyButtonText = document.getElementById("copyButtonText"); // Added for dynamic text

      const wordCountSpan = document.getElementById("wordCount");
      const charCountSpan = document.getElementById("charCount");

      // State variables
      let currentActiveFeature = null; // 'grammar', 'summarize', 'tone', 'paraphrase', 'keywords', 'readability', 'conciseness'
      let currentResultText = ""; // Text to be copied to clipboard

      /**
       * Updates the word and character counts based on the textarea content.
       */
      const updateCounts = () => {
        const text = inputTextarea.value;
        const words = text.trim() === "" ? 0 : text.trim().split(/\s+/).length;
        const chars = text.length;
        wordCountSpan.textContent = `Words: ${words}`;
        charCountSpan.textContent = `Characters: ${chars}`;
      };

      /**
       * Sets the loading state for all feature buttons and shows/hides the main spinner.
       * @param {boolean} isLoading - True to show loading spinner, false to hide.
       * @param {string} featureName - The name of the feature being loaded (e.g., 'Checking Grammar').
       */
      const setLoadingState = (isLoading, featureName = "Processing") => {
        const featureButtons = document.querySelectorAll(".feature-card"); // Target feature cards
        featureButtons.forEach((button) => {
          button.disabled = isLoading;
        });
        clearAllButton.disabled = isLoading; // Also disable clear button during loading

        if (isLoading) {
          loadingContainer.classList.remove("hidden");
          loadingText.textContent = `${featureName}...`;
          outputContainer.classList.add("hidden"); // Hide output while loading
          copyButtonContainer.classList.add("hidden"); // Hide copy button
          generalPlaceholderText.classList.add("hidden"); // Ensure placeholder is hidden
        } else {
          loadingContainer.classList.add("hidden");
          outputContainer.classList.remove("hidden"); // Show output after loading
          // Placeholder visibility handled by activateFeatureOutput
        }
      };

      /**
       * Displays a general error message to the user.
       * @param {string} message - The error message to display.
       * @param {number} duration - How long to display the message in milliseconds (0 for permanent).
       */
      const displayGeneralMessage = (message, duration = 0) => {
        errorMessage.textContent = message;
        errorMessage.classList.remove("hidden");
        if (duration > 0) {
          setTimeout(() => {
            errorMessage.classList.add("hidden");
            errorMessage.textContent = "";
          }, duration);
        }
      };

      /**
       * Displays a feature-specific error message.
       * @param {string} featureId - The ID of the feature (e.g., 'grammar', 'summarize').
       * @param {string} message - The error message.
       */
      const displayFeatureError = (featureId, message) => {
        const outputSection = featureOutputs[featureId].container;
        const errorMessageElement = outputSection.querySelector(
          ".feature-error-message"
        );
        if (errorMessageElement) {
          errorMessageElement.textContent = message;
          errorMessageElement.classList.remove("hidden");
        }
        featureOutputs[featureId].content.innerHTML = ""; // Clear main content if error
      };

      /**
       * Clears all error messages (general and feature-specific).
       */
      const clearMessages = () => {
        errorMessage.classList.add("hidden");
        errorMessage.textContent = "";
        document.querySelectorAll(".feature-error-message").forEach((el) => {
          el.classList.add("hidden");
          el.textContent = "";
        });
      };

      /**
       * Activates the specified output section and hides others.
       * @param {string | null} feature - The feature whose output section should be shown ('grammar', 'summarize', 'tone', etc.) or null to show general placeholder.
       */
      const activateFeatureOutput = (feature) => {
        // Remove active state from all feature cards
        document.querySelectorAll(".feature-card").forEach((card) => {
          card.classList.remove(
            "ring-2",
            "ring-indigo-500",
            "border-indigo-500",
            "bg-indigo-50"
          );
          // Dark theme specific classes
          card.classList.add("bg-gray-900", "border-gray-700");
          // Revert to default inactive style
          if (card.id === "clearAllButton") {
            card.classList.add("bg-gray-700", "border-gray-600");
            card.classList.remove("bg-gray-900", "border-gray-700");
          }
        });

        // Hide all output sections and their error messages
        Object.values(featureOutputs).forEach((item) => {
          item.container.classList.add("hidden");
          item.container
            .querySelector(".feature-error-message")
            .classList.add("hidden");
        });
        generalPlaceholderText.classList.add("hidden"); // Always hide general placeholder when a specific feature is active

        if (feature && featureOutputs[feature]) {
          featureOutputs[feature].container.classList.remove("hidden");
          // Add active state to the selected feature card
          const selectedButton = document.querySelector(
            `.feature-card[data-feature="${feature}"]`
          );
          if (selectedButton) {
            selectedButton.classList.add(
              "ring-2",
              "ring-indigo-500",
              "border-indigo-500"
            );
            selectedButton.classList.remove("bg-gray-900", "border-gray-700"); // Remove default inactive style
            selectedButton.classList.add("bg-gray-700", "border-gray-600"); // Use a slightly lighter dark color for active state
          }
        } else {
          generalPlaceholderText.classList.remove("hidden"); // Fallback to general placeholder
        }
        currentActiveFeature = feature;

        // Manage copy button visibility based on currentResultText
        if (currentResultText && feature) {
          // Only show copy if there's a result AND a feature is active
          copyButtonContainer.classList.remove("hidden");
        } else {
          copyButtonContainer.classList.add("hidden");
        }
        // Reset copy button text
        copyButtonText.textContent = "Copy Result";
      };

      /**
       * Clears all content in the input and output areas.
       */
      clearAllButton.addEventListener("click", () => {
        inputTextarea.value = "";
        // Clear all feature output contents
        Object.values(featureOutputs).forEach(
          (item) => (item.content.innerHTML = "")
        ); // Use innerHTML for grammar diff

        currentResultText = "";
        updateCounts();
        clearMessages();
        generalPlaceholderText.classList.remove("hidden"); // Ensure general placeholder is hidden temporarily
        copyButtonContainer.classList.add("hidden"); // Hide copy button
        activateFeatureOutput(null); // Hide all feature-specific outputs and show general placeholder
        setLoadingState(false); // Ensure loading is off
      });

      /**
       * Handles the input event for the textarea.
       * Clears error messages and updates counts.
       */
      inputTextarea.addEventListener("input", () => {
        clearMessages(); // Clear all error messages
        updateCounts();
        // Clear current result text and hide copy button on input change
        currentResultText = "";
        copyButtonContainer.classList.add("hidden");

        // Clear the content of all feature output sections (use innerHTML for grammar)
        Object.values(featureOutputs).forEach(
          (item) => (item.content.innerHTML = "")
        );

        // Revert to general placeholder if input is cleared or edited
        if (inputTextarea.value.trim() === "") {
          activateFeatureOutput(null); // Shows general placeholder
        } else {
          // If text exists, but user is typing, just ensure specific outputs are clear
          // and the correct active feature output is shown if one was previously selected.
          if (currentActiveFeature && featureOutputs[currentActiveFeature]) {
            activateFeatureOutput(currentActiveFeature); // Re-show the active output, but with cleared content
          } else {
            // If no feature was active, just ensure the output area is ready but no specific feature displayed
            generalPlaceholderText.classList.remove("hidden");
            outputContainer.classList.remove("hidden");
          }
        }
      });

      /**
       * Generic function to make API calls to Gemini.
       * @param {string} prompt - The prompt to send to the Gemini model.
       * @returns {Promise<string>} - A promise that resolves with the generated text.
       */
      const callGeminiAPI = async (prompt) => {
        const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
        const payload = { contents: chatHistory };
        const apiKey = "AIzaSyCsdeFOJrU43BZmnRP5WD1pm80fZH1cxN4";

        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

        const response = await fetch(apiUrl, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        let result;
        if (!response.ok) {
          let errorDetails = `Status: ${response.status} - ${response.statusText}.`;
          try {
            // Try to parse as JSON first, assuming most API errors are JSON
            const errorJson = await response.json();
            errorDetails += ` Details: ${
              errorJson.error?.message || JSON.stringify(errorJson, null, 2)
            }`;
          } catch (jsonParseError) {
            // If JSON parsing fails, it might be plain text or truly empty
            try {
              const rawText = await response.text();
              if (rawText.trim()) {
                errorDetails += ` Raw Response: ${rawText.substring(
                  0,
                  200
                )}...`; // Truncate long raw text
              } else {
                errorDetails +=
                  " No specific error message provided by the API body.";
              }
            } catch (readTextError) {
              errorDetails += " Failed to read response body.";
            }
          }
          throw new Error(`API request failed. ${errorDetails}`);
        } else {
          try {
            // Attempt to parse JSON for a successful response
            result = await response.json();
          } catch (jsonParseError) {
            // If JSON parsing fails even for a 200 OK response (e.g., empty body or plain text)
            const rawText = await response.text(); // Read raw text to debug
            console.error(
              "Failed to parse successful response as JSON:",
              jsonParseError,
              "Raw response:",
              rawText
            );
            throw new Error(
              `API returned success but response was not valid JSON. Details: ${
                rawText.substring(0, 200) || "Response was empty or malformed."
              }`
            );
          }
        }

        // Check if result and its properties exist before accessing them
        if (
          result &&
          result.candidates &&
          result.candidates.length > 0 &&
          result.candidates[0].content &&
          result.candidates[0].content.parts &&
          result.candidates[0].content.parts.length > 0
        ) {
          return result.candidates[0].content.parts[0].text;
        } else {
          console.log(
            "Unexpected API response structure or empty content:",
            result
          );
          throw new Error(
            "AI did not return expected content. This might happen with very short or ambiguous inputs."
          );
        }
      };

      /**
       * Highlights the differences between two strings word by word.
       * Words in original but not corrected are marked as deleted.
       * Words in corrected but not original are marked as inserted.
       * @param {string} originalText - The original string.
       * @param {string} correctedText - The corrected string.
       * @returns {string} HTML string with differences highlighted.
       */
      function highlightDifferences(originalText, correctedText) {
        // Split by words and common punctuation to handle them as separate tokens
        const splitRegex = /(\s+|[.,!?;:()"])/g;
        const wordsOriginal = originalText
          .split(splitRegex)
          .filter((s) => s.trim() !== "");
        const wordsCorrected = correctedText
          .split(splitRegex)
          .filter((s) => s.trim() !== "");

        let html = "";
        let origIdx = 0;
        let corrIdx = 0;

        // Simplified diffing: try to match words sequentially, mark as added/deleted if mismatch
        while (
          origIdx < wordsOriginal.length ||
          corrIdx < wordsCorrected.length
        ) {
          const originalWord = wordsOriginal[origIdx];
          const correctedWord = wordsCorrected[corrIdx];

          if (originalWord === correctedWord) {
            // Match found, add as unchanged
            html += `<span>${originalWord}</span>`;
            origIdx++;
            corrIdx++;
          } else {
            // Mismatch: look ahead to find if a word was deleted or added
            let foundMatchInCorrected = false;
            let foundMatchInOriginal = false;

            // Check if current original word appears later in corrected
            let lookAheadCorrIdx = corrIdx;
            while (lookAheadCorrIdx < wordsCorrected.length) {
              if (wordsCorrected[lookAheadCorrIdx] === originalWord) {
                foundMatchInCorrected = true;
                break;
              }
              lookAheadCorrIdx++;
            }

            // Check if current corrected word appears later in original
            let lookAheadOrigIdx = origIdx;
            while (lookAheadOrigIdx < wordsOriginal.length) {
              if (wordsOriginal[lookAheadOrigIdx] === correctedWord) {
                foundMatchInOriginal = true;
                break;
              }
              lookAheadOrigIdx++;
            }

            if (foundMatchInCorrected && !foundMatchInOriginal) {
              // Original word is coming up in corrected, so current corrected is an addition
              html += `<ins class="bg-green-900/50 text-green-400 px-0.5 rounded">${correctedWord}</ins>`;
              corrIdx++;
            } else if (foundMatchInOriginal && !foundMatchInCorrected) {
              // Corrected word is coming up in original, so current original is a deletion
              html += `<del class="bg-red-900/50 text-red-400 line-through px-0.5 rounded">${originalWord}</del>`;
              origIdx++;
            } else if (
              originalWord !== undefined &&
              correctedWord !== undefined
            ) {
              // Both are different, consider it a change (deletion + addition)
              html += `<del class="bg-red-900/50 text-red-400 line-through px-0.5 rounded">${originalWord}</del>`;
              html += `<ins class="bg-green-900/50 text-green-400 px-0.5 rounded">${correctedWord}</ins>`;
              origIdx++;
              corrIdx++;
            } else if (originalWord !== undefined) {
              // Remaining original words are deletions
              html += `<del class="bg-red-900/50 text-red-400 line-through px-0.5 rounded">${originalWord}</del>`;
              origIdx++;
            } else if (correctedWord !== undefined) {
              // Remaining corrected words are additions
              html += `<ins class="bg-green-900/50 text-green-400 px-0.5 rounded">${correctedWord}</ins>`;
              corrIdx++;
            }
          }
          // Add a space after each word/tag unless it's punctuation or the end
          if (
            (origIdx < wordsOriginal.length ||
              corrIdx < wordsCorrected.length) &&
            !splitRegex.test(wordsOriginal[origIdx - 1] || "") &&
            !splitRegex.test(wordsCorrected[corrIdx - 1] || "") &&
            !splitRegex.test(wordsOriginal[origIdx] || "") &&
            !splitRegex.test(wordsCorrected[corrIdx] || "")
          ) {
            html += " ";
          } else if (
            splitRegex.test(wordsOriginal[origIdx - 1] || "") ||
            splitRegex.test(wordsCorrected[corrIdx - 1] || "")
          ) {
            // If the previous character was a space/punctuation, add a space unless current is punctuation too
            if (
              splitRegex.test(wordsOriginal[origIdx] || "") ||
              splitRegex.test(wordsCorrected[corrIdx] || "")
            ) {
              // No space if next is also punctuation
            } else if (html.length > 0 && !html.endsWith(" ")) {
              // Add space only if not already there
              html += " ";
            }
          }
        }
        return html.replace(/\s+/g, " ").trim(); // Clean up multiple spaces
      }

      /**
       * Main function to handle feature requests.
       * @param {string} featureId - The ID of the feature being requested (e.g., 'grammar').
       * @param {string} loadingMsg - The message to show in the loading spinner.
       * @param {function(string): string} promptFunc - A function that takes the input text and returns the Gemini prompt.
       * @param {HTMLElement} outputElement - The DOM element where the result should be displayed.
       * @param {string} errorPlaceholderText - The text to display in the output if an error occurs.
       */
      const handleFeatureRequest = async (
        featureId,
        loadingMsg,
        promptFunc,
        outputElement,
        errorPlaceholderText
      ) => {
        const originalInputText = inputTextarea.value.trim(); // Capture original text here
        if (!originalInputText) {
          displayGeneralMessage("Please enter some text to use this feature.");
          return;
        }

        setLoadingState(true, loadingMsg);
        clearMessages(); // Clear all previous error/general messages
        outputElement.innerHTML = ""; // Use innerHTML for grammar diff
        currentResultText = ""; // Clear for copy
        copyButtonContainer.classList.add("hidden"); // Hide copy button until new result

        try {
          activateFeatureOutput(featureId); // Activate the output section for this feature
          const prompt = promptFunc(originalInputText); // Use originalInputText for prompt
          const result = await callGeminiAPI(prompt);

          if (featureId === "grammar") {
            // For grammar, highlight differences
            outputElement.innerHTML = highlightDifferences(
              originalInputText,
              result
            );
          } else {
            // For other features, just set the text content
            outputElement.textContent = result;
          }

          currentResultText = result; // Set for copy functionality
          copyButtonContainer.classList.remove("hidden"); // Show copy button
        } catch (err) {
          console.error(`Error with ${featureId} feature:`, err);
          displayFeatureError(
            featureId,
            `Error: ${err.message}. ${errorPlaceholderText}`
          );
          outputElement.innerHTML = ""; // Clear main content area on error
        } finally {
          setLoadingState(false);
        }
      };

      // Event Listeners for each feature button
      checkGrammarBtn.addEventListener("click", () => {
        handleFeatureRequest(
          "grammar",
          "Checking Grammar",
          (text) =>
            `Please correct the grammar and spelling in the following English text. Provide only the corrected text, without any additional explanations or formatting. Do not include any conversational filler or introductions, just the corrected text:\n\n"${text}"`,
          correctedText,
          "Could not get grammar correction. Please ensure your text is clear and try again."
        );
      });

      summarizeButton.addEventListener("click", () => {
        handleFeatureRequest(
          "summarize",
          "Summarizing Text",
          (text) =>
            `Summarize the following English text concisely, extracting the main points and key information. Provide only the summary, without any introductions, conversational filler, or bullet points unless explicitly found in the original text. Aim for 3-5 well-formed sentences or a compact paragraph:\n\n"${text}"`,
          summarizedText,
          "Could not generate summary. This may occur with very short or highly unstructured text. Please try again with more substantial content."
        );
      });

      analyzeToneButton.addEventListener("click", () => {
        handleFeatureRequest(
          "tone",
          "Analyzing Tone",
          (text) =>
            `Analyze the overall tone and sentiment of the following English text. Identify the 1-3 primary tones (e.g., formal, informal, optimistic, critical, neutral, persuasive, professional, casual, urgent, empathetic, authoritative). For each identified tone, provide a very brief, concise explanation (1-2 sentences) of why, citing specific words or phrases as examples if possible. Format your response as a list of "Tone: [Tone Name] - [Explanation]." Do not include any introductions or conversational filler:\n\n"${text}"`,
          analyzedTone,
          "Could not analyze tone. This might happen with very short or ambiguous inputs. Please try again."
        );
      });

      paraphraseButton.addEventListener("click", () => {
        handleFeatureRequest(
          "paraphrase",
          "Paraphrasing Text",
          (text) =>
            `Rewrite the following English text to improve clarity, conciseness, and flow, while retaining the original meaning. Focus on providing a fresh phrasing. Provide only the rephrased text, without any introductions or conversational filler:\n\n"${text}"`,
          paraphrasedText,
          "Could not paraphrase text. The text might be too short or complex for effective rephrasing. Please try again."
        );
      });

      keywordsButton.addEventListener("click", () => {
        handleFeatureRequest(
          "keywords",
          "Extracting Keywords",
          (text) =>
            `Extract the 5-10 most important keywords or key phrases from the following English text. List them as a comma-separated list. Do not include any introductions, conversational filler, or numbering/bullet points, just the keywords/phrases:\n\n"${text}"`,
          extractedKeywords,
          "Could not extract keywords. This might occur if the text lacks clear main topics. Please try again."
        );
      });

      readabilityButton.addEventListener("click", () => {
        handleFeatureRequest(
          "readability",
          "Assessing Readability",
          (text) =>
            `Assess the readability of the following English text. Provide a qualitative assessment (e.g., "Very Easy," "Easy," "Moderate," "Challenging," "Very Challenging") and a brief, 1-sentence explanation of why, without any introductions or conversational filler:\n\n"${text}"`,
          readabilityAssessment,
          "Could not assess readability. Please ensure your text is sufficient for assessment and try again."
        );
      });

      concisenessButton.addEventListener("click", () => {
        handleFeatureRequest(
          "conciseness",
          "Checking Conciseness",
          (text) =>
            `Review the following English text for conciseness. Suggest specific areas or phrases that could be made more concise without losing meaning. If the text is already concise, state that. Provide your suggestions as a bulleted list. Do not include any introductions or conversational filler:\n\n"${text}"`,
          concisenessSuggestions,
          "Could not check conciseness. This may happen if the text is very short or already highly concise. Please try again."
        );
      });

      /**
       * Copies the current result text to the clipboard.
       */
      copyToClipboardBtn.addEventListener("click", () => {
        if (currentResultText) {
          const textarea = document.createElement("textarea");
          textarea.value = currentResultText;
          document.body.appendChild(textarea);
          textarea.select();
          try {
            document.execCommand("copy");
            copyButtonText.textContent = "Copied!"; // Temporarily change button text
            setTimeout(() => {
              copyButtonText.textContent = "Copy Result"; // Revert after 2 seconds
            }, 2000);
          } catch (err) {
            console.error("Failed to copy text: ", err);
            displayGeneralMessage("Failed to copy text.");
          }
          document.body.removeChild(textarea);
        }
      });

      // Initial setup
      updateCounts(); // Set initial counts
      activateFeatureOutput(null); // Start with general placeholder visible
    </script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.2/dist/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.2/dist/ScrollTrigger.min.js"></script>
    <script src="free-resourses-details.js"></script>
    <script src="dropdown-settings.js"></script>
    <script src="app.js"></script>
    <script src="gsap.js"></script>
    <script type="module" src="auth.js"></script>
    <script type="module" src="auth-page-loading.js"></script>
    <script src="navigation.js"></script>
  </body>
</html>
