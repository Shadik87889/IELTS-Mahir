<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IELTS Idea Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="navigation-dark.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- font awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #0c0d12; /* A slightly darker, richer background */
        color: #e2e8f0;
        position: relative;
        overflow-x: hidden;
      }

      /* Animated grid overlay for a high-tech feel */
      body::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: linear-gradient(
            rgba(141, 148, 163, 0.05) 1px,
            transparent 1px
          ),
          linear-gradient(90deg, rgba(141, 148, 163, 0.05) 1px, transparent 1px);
        background-size: 50px 50px;
        z-index: -1;
        opacity: 0.8;
        animation: move-grid 20s linear infinite;
      }

      @keyframes move-grid {
        from {
          background-position: 0 0;
        }
        to {
          background-position: 50px 50px;
        }
      }

      /* Custom scrollbar for a cleaner look */
      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #2d3748; /* Dark track */
        border-radius: 10px;
      }
      ::-webkit-scrollbar-thumb {
        background: #4a5568; /* Darker thumb */
        border-radius: 10px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #667eea; /* Indigo on hover */
      }

      .input-focus:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.5); /* Indigo glow */
        border-color: #667eea;
      }

      .output-section h3 {
        font-size: 1.5rem; /* text-2xl */
        font-weight: 700; /* font-bold */
        color: #e2e8f0; /* Light text */
        margin-top: 1.5rem;
        margin-bottom: 0.5rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid #4a5568; /* Subtle dark border */
      }
      .output-section .main-list {
        padding-top: 0.5rem;
        list-style-type: none;
        padding-left: 0;
      }
      .output-section .main-list > li {
        margin-bottom: 1rem;
      }
      .output-section .sub-list {
        list-style-type: disc;
        padding-left: 2rem;
        margin-top: 0.5rem;
      }
      .output-section .sub-list li {
        margin-bottom: 0.5rem;
        font-size: 1rem;
        color: #a0aec0; /* Lighter gray for details */
        line-height: 1.75;
      }
      .output-section .sub-list li .bold-text {
        font-weight: 600;
        color: #e2e8f0;
      }

      /* Custom glow effect for the button */
      .btn-glow {
        box-shadow: 0 0 15px -5px rgba(102, 126, 234, 0.6);
        transition: box-shadow 0.3s ease-in-out, transform 0.2s ease-in-out;
      }
      .btn-glow:hover {
        box-shadow: 0 0 25px -5px rgba(102, 126, 234, 0.8);
        transform: translateY(-2px);
      }

      .input-output-parent {
        border: 2px solid #4a5568; /* Subtle dark border */
        height: 80vh;
      }
      @media (max-width: 768px) {
        .input-output-parent {
          height: auto; /* Allow height to adjust on smaller screens */
        }
      }
    </style>
  </head>
  <body class="flex flex-col items-center justify-center p-2 min-h-screen">
    <nav>
      <div class="logo-ai-parent">
        <a href="home.html" class="logo">
          <img
            src="assets/278115481_106536582034386_7446598694214552893_n-removebg-preview.png"
            alt="Ielts mahir logo"
          />
        </a>
      </div>
      <div id="auth-buttons-container" class="auth-container">
        <div class="auth-loading-pulse">
          <div class="auth-loading-circle"></div>
          <div class="auth-loading-content">
            <div class="auth-loading-bar"></div>
            <div class="auth-loading-grid">
              <div class="auth-loading-bar auth-loading-col-2"></div>
              <div class="auth-loading-bar auth-loading-col-1"></div>
            </div>
            <div class="auth-loading-bar"></div>
          </div>
        </div>
      </div>
    </nav>
    <div
      class="input-output-parent w-full flex max-w-6xl p-8 bg-[#222a36] rounded-3xl flex flex-col lg:flex-row gap-8 mt-[22vw] md:mt-[16vw] lg:mt-0 lg:gap-12"
    >
      <!-- Input Section -->
      <div class="flex-1 flex flex-col">
        <h1 class="text-5xl font-extrabold text-white mb-2">
          IELTS Idea Generator
        </h1>
        <p class="text-[#a0aec0] mb-8">
          Get a world-class essay outline instantly.
        </p>
        <div class="flex-grow mb-4">
          <textarea
            id="topicInput"
            rows="10"
            placeholder="e.g., 'Some people believe that zoos are cruel and should be closed down. Others argue that they are important for education and conservation. Discuss both views and give your opinion.'"
            class="input-focus w-full h-full p-5 text-lg text-white bg-[#1a202c] border border-[#4a5568] rounded-2xl transition-all duration-200 resize-none placeholder-[#a0aec0]"
          ></textarea>
        </div>
        <button
          id="generateBtn"
          class="w-full px-8 py-4 text-lg font-bold text-white bg-[#667eea] rounded-2xl shadow-lg btn-glow disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none disabled:shadow-none"
        >
          <span id="buttonText">Generate Outline</span>
          <svg
            id="buttonSpinner"
            class="hidden animate-spin h-6 w-6 text-white mx-auto"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
          >
            <circle
              class="opacity-25"
              cx="12"
              cy="12"
              r="10"
              stroke="currentColor"
              stroke-width="4"
            ></circle>
            <path
              class="opacity-75"
              fill="currentColor"
              d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
            ></path>
          </svg>
        </button>
      </div>

      <!-- Output Section -->
      <div class="flex-1 flex flex-col relative">
        <h2 class="text-4xl font-bold text-white mb-6">Generated Outline</h2>
        <div
          id="outputArea"
          class="output-section flex-grow p-6 bg-[#1a202c] rounded-2xl border border-[#4a5568] shadow-inner overflow-y-auto min-h-[300px] lg:min-h-0 text-[#e2e8f0]"
        >
          <p id="placeholder" class="text-center text-[#a0aec0] italic mt-12">
            Your outline will appear here.
          </p>

          <!-- Error message box -->
          <div
            id="errorBox"
            class="p-4 bg-red-900 border border-red-700 text-red-200 rounded-xl hidden"
            role="alert"
          >
            <p class="font-bold">Error:</p>
            <p id="errorMessage"></p>
          </div>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const topicInput = document.getElementById("topicInput");
        const generateBtn = document.getElementById("generateBtn");
        const buttonText = document.getElementById("buttonText");
        const buttonSpinner = document.getElementById("buttonSpinner");
        const outputArea = document.getElementById("outputArea");
        const placeholder = document.getElementById("placeholder");
        const errorBox = document.getElementById("errorBox");
        const errorMessage = document.getElementById("errorMessage");

        // Hardcoded API key from the user's request
        const API_KEY = "AIzaSyCsdeFOJrU43BZmnRP5WD1pm80fZH1cxN4";

        generateBtn.addEventListener("click", async () => {
          const topic = topicInput.value.trim();
          if (topic === "") {
            showError("Please enter an IELTS essay topic to get started.");
            return;
          }

          // Show loading state
          placeholder.classList.add("hidden");
          outputArea.innerHTML = "";
          errorBox.classList.add("hidden");
          generateBtn.disabled = true;
          buttonText.classList.add("hidden");
          buttonSpinner.classList.remove("hidden");

          const prompt = `Generate a detailed IELTS essay outline for the following topic. The outline should be structured as follows:

Introduction:
- A concise introductory sentence.
- A clear thesis statement.

Arguments Against Zoos:
- Topic Sentence: A clear statement of the main argument.
- Supporting Point 1: A specific detail or example.
- Supporting Point 2: Another specific detail or example.
- Supporting Point 3: A final specific detail or example.

Arguments For Zoos:
- Topic Sentence: A clear statement of the opposing argument.
- Supporting Point 1: A specific detail or example.
- Supporting Point 2: Another specific detail or example.
- Supporting Point 3: A final specific detail or example.

Conclusion:
- A summary of the main points and a final opinion.

IELTS Topic: "${topic}"`;

          let retryCount = 0;
          const maxRetries = 3;
          const initialDelay = 1000;

          async function fetchWithRetry() {
            try {
              const payload = {
                contents: [
                  {
                    parts: [{ text: prompt }],
                  },
                ],
              };
              const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;
              const response = await fetch(apiUrl, {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(payload),
              });

              if (!response.ok) {
                throw new Error(
                  `API call failed with status: ${response.status}`
                );
              }

              const result = await response.json();

              if (
                result.candidates &&
                result.candidates.length > 0 &&
                result.candidates[0].content &&
                result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0
              ) {
                const generatedText =
                  result.candidates[0].content.parts[0].text;
                renderOutput(generatedText);
              } else {
                throw new Error("Invalid response from API. Please try again.");
              }
            } catch (error) {
              if (retryCount < maxRetries) {
                retryCount++;
                const delay = initialDelay * Math.pow(2, retryCount);
                setTimeout(fetchWithRetry, delay);
              } else {
                console.error("Failed to fetch after multiple retries:", error);
                showError(
                  "Failed to generate ideas. Please check your network connection or try again later."
                );
              }
            } finally {
              // Hide loading state
              buttonText.classList.remove("hidden");
              buttonSpinner.classList.add("hidden");
              generateBtn.disabled = false;
            }
          }

          fetchWithRetry();
        });

        function renderOutput(text) {
          // Split the output by major headings (e.g., "Introduction:", "Arguments Against Zoos:")
          const sections = text
            .split(
              /^(?=Introduction:|Arguments Against Zoos:|Arguments For Zoos:|Conclusion:)/m
            )
            .filter((s) => s.trim() !== "");
          let htmlContent = "";

          sections.forEach((section) => {
            // Split each section into lines
            const lines = section
              .trim()
              .split("\n")
              .filter((line) => line.trim() !== "");
            if (lines.length === 0) return;

            // The first line is always the heading
            const title = lines[0].replace(/[:*-]/g, "").trim();
            htmlContent += `<h3 class="mt-6 text-2xl font-bold text-white">${title}</h3>`;

            if (lines.length > 1) {
              htmlContent += `<ul class="sub-list">`;
              for (let i = 1; i < lines.length; i++) {
                // Sanitize the line by removing leading stars, hyphens, or other list markers
                const line = lines[i].trim().replace(/^[\*-]+\s*/, "");

                // Check for sub-points with a colon, like "Topic Sentence:"
                const subHeadingMatch = line.match(/^(.+?):/);
                if (subHeadingMatch) {
                  const subHeading = subHeadingMatch[1].trim();
                  const subContent = line
                    .substring(subHeadingMatch[0].length)
                    .trim();
                  htmlContent += `<li><span class="bold-text">${subHeading}:</span> ${subContent}</li>`;
                } else {
                  htmlContent += `<li>${line}</li>`;
                }
              }
              htmlContent += `</ul>`;
            }
          });

          outputArea.innerHTML = htmlContent;
        }

        function showError(message) {
          errorBox.classList.remove("hidden");
          errorMessage.textContent = message;
          outputArea.innerHTML = "";
          placeholder.classList.remove("hidden");
          buttonText.classList.remove("hidden");
          buttonSpinner.classList.add("hidden");
          generateBtn.disabled = false;
        }
      });
    </script>
    <script type="module" src="auth.js"></script>
    <script type="module" src="auth-page-loading.js"></script>
    <script src="navigation.js"></script>
  </body>
</html>
